{"ast":null,"code":"import { __decorate, __metadata } from \"tslib\";\nimport { Component } from \"node_modules/@angular/core\";\nimport { FormBuilder } from \"node_modules/@angular/forms\";\nimport { Store } from \"node_modules/@ngrx/store\";\nimport * as fromReducer from \"../../store/users/user.reducer\";\nimport * as fromActions from \"../../store/users/user.actions\";\nimport { UserObject } from \"../../store/modal/user.modal\";\nlet UserComponent = class UserComponent {\n  constructor(formBuilder, store) {\n    this.formBuilder = formBuilder;\n    this.store = store;\n    this.task = \"\";\n    this.userForm = {};\n    this.count$ = store.select(fromReducer.UsersCount);\n    this.allUsers$ = store.select(fromReducer.selectAllUsers);\n    this.userIds$ = store.select(fromReducer.selectUserIds);\n    this.userById$ = store.select(fromReducer.selectCurrentUser);\n    this.userId = 0;\n  }\n  ngOnInit() {\n    this.store.dispatch(fromActions.LoadUsers());\n  }\n  createBlankUserForm() {\n    this.userForm = this.formBuilder.group({\n      UsersArray: this.formBuilder.array([])\n    });\n  }\n  createUserFormForAdd() {\n    this.createBlankUserForm();\n    this.addMoreControlForAdd();\n  }\n  get UsersFormArray() {\n    return this.userForm.get(\"UsersArray\");\n  }\n  addMoreControlForAdd() {\n    let ag = this.formBuilder.group(new UserObject());\n    this.UsersFormArray.push(ag);\n  }\n  updateUserForm() {\n    this.createBlankUserForm();\n    this.allUsers$.subscribe(Users => {\n      if (Users && Users.length > 0) {\n        let User = Users[0];\n        let ag = this.formBuilder.group(User);\n        this.UsersFormArray.push(ag);\n      }\n    });\n  }\n  addMoreControlForUpdate() {\n    this.allUsers$.subscribe(Users => {\n      if (Users && Users.length > 0 && this.UsersFormArray.length < Users.length) {\n        let len = this.UsersFormArray.length;\n        let User = Users[len];\n        let ag = this.formBuilder.group(User);\n        this.UsersFormArray.push(ag);\n      }\n    });\n  }\n  deleteFormArrayControl(idx) {\n    this.UsersFormArray.removeAt(idx);\n  }\n  addUserView() {\n    this.task = \"add\";\n    this.createUserFormForAdd();\n  }\n  updateUserView() {\n    this.task = \"update\";\n    this.updateUserForm();\n  }\n  removeUserView() {\n    this.task = \"remove\";\n    this.createBlankUserForm();\n    this.allUsers$.subscribe(Users => {\n      this.createBlankUserForm();\n      Users.forEach(User => {\n        let ag = this.formBuilder.group({\n          UserData: User,\n          chk: false\n        });\n        this.UsersFormArray.push(ag);\n      });\n    });\n  }\n  userByIdView() {\n    this.task = \"select\";\n  }\n  onFormSubmitForAdd() {\n    if (this.UsersFormArray.length === 1) {\n      this.addUser(this.UsersFormArray.at(0).value);\n    } else if (this.UsersFormArray.length > 1) {\n      this.addUsers(this.UsersFormArray.value);\n    }\n    this.createBlankUserForm();\n    this.loadAllUsers();\n  }\n  onFormSubmitForUpdate() {\n    if (this.UsersFormArray.length === 1) {\n      this.updateUser(this.UsersFormArray.at(0).value);\n    } else if (this.UsersFormArray.length > 1) {\n      this.updateUsers(this.UsersFormArray.value);\n    }\n    this.createBlankUserForm();\n    this.loadAllUsers();\n  }\n  onFormSubmitForRemove() {\n    let UserIdsToDelete = [];\n    this.UsersFormArray.controls.forEach(result => {\n      if (result.get(\"chk\")?.value) {\n        UserIdsToDelete.push(result.get(\"UserData\")?.value.id);\n      }\n    });\n    if (UserIdsToDelete.length == 1) {\n      this.removeUser(UserIdsToDelete[0]);\n    } else if (UserIdsToDelete.length > 1) {\n      this.removeUsers(UserIdsToDelete);\n    }\n  }\n  addUser(data) {\n    this.store.dispatch(fromActions.AddUser({\n      payload: {\n        user: data\n      }\n    }));\n  }\n  addUsers(data) {\n    this.store.dispatch(fromActions.AddUsers({\n      payload: {\n        users: data\n      }\n    }));\n  }\n  updateUser(data) {\n    this.store.dispatch(fromActions.UpdateUser({\n      payload: {\n        user: {\n          id: data.id,\n          changes: data\n        }\n      }\n    }));\n  }\n  updateUsers(data) {\n    let allUpdates = data.map(User => Object.assign({}, {\n      id: User.id,\n      changes: User\n    }));\n    this.store.dispatch(fromActions.UpdateUsers({\n      payload: {\n        users: allUpdates\n      }\n    }));\n  }\n  removeUser(userId) {\n    this.store.dispatch(fromActions.RemoveUser({\n      payload: {\n        id: userId\n      }\n    }));\n  }\n  removeUsers(userIds) {\n    this.store.dispatch(fromActions.RemoveUsers({\n      payload: {\n        ids: userIds\n      }\n    }));\n  }\n  clearAllUsers() {\n    this.store.dispatch(fromActions.ClearUsers());\n  }\n  loadAllUsers() {\n    this.task = \"all\";\n  }\n  selectUserById() {\n    this.store.dispatch(fromActions.SelectUser({\n      payload: {\n        userId: this.userId\n      }\n    }));\n  }\n};\nUserComponent = __decorate([Component({\n  selector: \"app-users\",\n  templateUrl: \"users.component.html\",\n  standalone: false\n}), __metadata(\"design:paramtypes\", [FormBuilder, Store])], UserComponent);\nexport { UserComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}